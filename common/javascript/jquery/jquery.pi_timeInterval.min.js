(function(a){a.fn.pi_timeInterval=function(f){f=f||{};var g=a.extend({format:"%DD% %daylabel% %HH% %hourlabel% %MM% %minlabel%",empt:"Нет",DaysText:"Дней",HoursText:"Часов",MinText:"минут",daylabel:"Дн.",hourlabel:"час.",minlabel:"мин.",ResetTxt:"Сброс",CancelTxt:"Отмена",OkTxt:" Ок ",hidedays:false},f);var i=function(l){var j={};j.days=parseInt(l/(3600*24));j.daysf=j.days;j.daysf=(j.daysf>0&&j.daysf.toString().length<2)?("0"+j.daysf.toString()):j.daysf;var k=l-j.days*(3600*24);j.hours=parseInt(k/3600);j.hoursf=j.hours;j.hoursf=(j.hoursf>0&&j.hoursf.toString().length<2)?("0"+j.hoursf.toString()):j.hoursf;k-=j.hours*3600;j.mins=parseInt(k/60);j.minsf=j.mins;j.minsf=(j.minsf>0&&j.minsf.toString().length<2)?("0"+j.minsf.toString()):j.minsf;return j};var d=function(j){var l=g.format;j=j||0;if(j==0){return g.empt}var k=i(j);l=l.replace(/%dd%/g,(k.days?k.days:""));l=l.replace(/%hh%/g,(k.hours?k.hours:""));l=l.replace(/%mm%/g,(k.mins?k.mins:""));l=l.replace(/%DD%/g,(k.days?k.daysf:""));l=l.replace(/%HH%/g,(k.hours?k.hoursf:"00"));l=l.replace(/%MM%/g,(k.mins?k.minsf:"00"));l=l.replace(/%daylabel%/g,(k.days?g.daylabel:""));l=l.replace(/%hourlabel%/g,(k.hours?g.hourlabel:""));l=l.replace(/%minlabel%/g,(k.mins?g.minlabel:""));return a.trim(l)};var c=function(){var j=document.createElement("div");var m=a(j);m.addClass("pi_tipicker_container").attr("id","pi_timepicker_popup");var l="";l+='<div class="pi_tipicker_label mdays">'+g.DaysText+"</div>";l+='<div class="pi_tipicker_range mdays">';l+='<div class="pi_tiline_decimal">';for(var k=0;k<10;k++){l+='<span class="pi_tidays_dec" val="'+k+'">'+k+"</span>"}l+="</div>";l+='<div class="pi_tiline_decimal">';for(var k=0;k<10;k++){l+='<span class="pi_tidays_one" val="'+k+'">'+k+"</span>"}l+="</div>";l+="</div>";l+='<div class="pi_tipicker_label">'+g.HoursText+"</div>";l+='<div class="pi_tipicker_range">';l+='<div class="pi_tiline_decimal">';for(var k=0;k<10;k++){l+='<span class="pi_tihours_dec '+(k>2?"disabled":"")+'" val="'+k+'">'+k+"</span>"}l+="</div>";l+='<div class="pi_tiline_decimal">';for(var k=0;k<10;k++){l+='<span class="pi_tihours_one" val="'+k+'">'+k+"</span>"}l+="</div>";l+="</div>";l+='<div class="pi_tipicker_label">'+g.MinText+"</div>";l+='<div class="pi_tipicker_range">';l+='<div class="pi_tiline_decimal">';for(var k=0;k<10;k++){l+='<span class="pi_timin_dec '+(k>5?"disabled":"")+'" val="'+k+'">'+k+"</span>"}l+="</div>";l+='<div class="pi_tiline_decimal">';for(var k=0;k<10;k++){l+='<span class="pi_timin_one" val="'+k+'">'+k+"</span>"}l+="</div>";l+="</div>";l+='<div class="pi_tiresult"></div>';l+='<div class="pi_tipicker_footer">';l+='<span class="pi_tipicker_btn" act="reset">'+g.ResetTxt+"</span>";l+='<span class="pi_tipicker_btn" act="cancel">'+g.CancelTxt+"</span>";l+='<span class="pi_tipicker_btn" act="set">'+g.OkTxt+"</span>";l+="</div>";m.html(l);j._recalcView=function(){a(this).find(".pi_tiresult").html(d(this._getValue()))};j._getValue=function(){var o=parseInt(a(this).find(".pi_tidays_dec.pi_selected").attr("val"));if(!o||o===null||isNaN(o)){o=0}var n=parseInt(a(this).find(".pi_tidays_one.pi_selected").attr("val"));if(!n||n===null||isNaN(n)){n=0}var u=parseInt(a(this).find(".pi_tihours_dec.pi_selected").attr("val"));if(!u||u===null||isNaN(u)){u=0}var s=parseInt(a(this).find(".pi_tihours_one.pi_selected").attr("val"));if(!s||s===null||isNaN(s)){s=0}var q=parseInt(a(this).find(".pi_timin_dec.pi_selected").attr("val"));if(!q||q===null||isNaN(q)){q=0}var p=parseInt(a(this).find(".pi_timin_one.pi_selected").attr("val"));if(!p||p===null||isNaN(p)){p=0}if(this._link&&this._link.length){var r=this._link.get(0);if(typeof(r.hidedays)!=="undefined"&&r.hidedays==1){o=0;n=0}}return o*(60*60*24*10)+n*(60*60*24)+u*36000+s*3600+q*600+p*60};j._setDecDay=function(n){a(this).find(".pi_tidays_dec").removeClass("pi_selected");a(this).find(".pi_tidays_dec[val="+n+"]").addClass("pi_selected")};j._setOneDay=function(n){a(this).find(".pi_tidays_one").removeClass("pi_selected");a(this).find(".pi_tidays_one[val="+n+"]").addClass("pi_selected")};j._setDecHour=function(o){var n=i(this._getValue()).hours;n=n-parseInt(n/10)*10;n=n+o*10;a(this).find(".pi_tihours_dec").removeClass("pi_selected");a(this).find(".pi_tihours_dec[val="+o+"]").addClass("pi_selected");if(n>23){this._setOneHour(0)}if(n>=20){a(this).find(".pi_tihours_one").each(function(){if(a(this).attr("val")>3){a(this).addClass("disabled")}})}else{a(this).find(".pi_tihours_one").removeClass("disabled")}};j._setOneHour=function(n){a(this).find(".pi_tihours_one").removeClass("pi_selected");a(this).find(".pi_tihours_one[val="+n+"]").addClass("pi_selected")};j._setDecMin=function(o){a(this).find(".pi_timin_dec").removeClass("pi_selected");a(this).find(".pi_timin_dec[val="+o+"]").addClass("pi_selected");var n=i(this._getValue()).mins;if(n>59){this._setOneMin(0)}};j._setOneMin=function(n){a(this).find(".pi_timin_one").removeClass("pi_selected");a(this).find(".pi_timin_one[val="+n+"]").addClass("pi_selected")};j.setDays=function(q){if(q>99){throw new error("CantControlDaysover99")}var o=parseInt(q/10);var n=q-o*10;if(this._link&&this._link.length){var p=this._link.get(0);if(typeof(p.hidedays)!=="undefined"&&p.hidedays==1){var o=0;var n=0}}this._setDecDay(o);this._setOneDay(n)};j.setHours=function(p){if(p>23){throw new error("CantControlhoursover23")}var o=parseInt(p/10);var n=p-o*10;this._setDecHour(o);this._setOneHour(n)};j.setMins=function(p){if(p>59){throw new error("CantControlMinutesover59")}var o=parseInt(p/10);var n=parseInt(p-o*10);this._setDecMin(o);this._setOneMin(n)};j.setValue=function(n){var o=i(n||0);this.setDays(o.days);this.setHours(o.hours);this.setMins(o.mins);this._recalcView()};j.link=function(o){this._link=o;if(this._link.length){var n=this._link.get(0);if(typeof(n.hidedays)!=="undefined"&&n.hidedays==1){this.hidedays()}else{this.showdays()}}};j.unlink=function(){this._link=null};j.actionreset=function(){var n=0;if(typeof(this._link)!=="undefined"&&this._link!==null){n=this._link.val()}this.setValue(n)};j.actioncancel=function(){this.unlink();this.disappear()};j.actionset=function(){if(typeof(this._link)!=="undefined"&&this._link!==null){this._link.val(this._getValue()).change()}this.unlink();this.disappear()};j.disappear=function(){a(this).hide();a(document).off(".pi_tipicker");if(typeof(pi_lib)==="function"&&typeof(this.EscId)!=="undefined"&&this.EscId!==null){var n=new pi_lib();n.ESC.removeHandler(this.EscId);this.EscId=null}};j.showdays=function(){a(this).find(".mdays").show()};j.hidedays=function(){a(this).find(".mdays").hide()};j.rps=function(){if(typeof(this._link)==="undefined"||this._link===null){return}var n=a(this._link.data("pi_tinterval"));var p=n.offset();var o=p.left+parseInt(n.outerWidth(false))/2;var s=p.top+parseInt(n.outerHeight(false))/2;var w=a(this);w.fadeIn(400);var u=w.outerWidth(false);var q=w.outerHeight(false);w.css({left:(o-u/2)+"px",top:(s-q/2)+"px"});a(document).on("click.pi_tipicker",function(){var t=b().get(0);if(t&&typeof(t.disappear)==="function"){t.disappear()}});if(typeof(pi_lib)==="function"){var r=new pi_lib();var v=this;this.EscId=r.ESC.addHandler("esc",function(){v.disappear()})}};m.on("click","span.pi_tidays_dec,span.pi_tidays_one,span.pi_tihours_dec,span.pi_tihours_one,span.pi_timin_dec,span.pi_timin_one",function(o){o.stopPropagation();o.preventDefault?o.preventDefault():o.returnValue=false;if(a(this).hasClass("disabled")){return}var n=o.delegateTarget;var p=a(this);var q=parseInt(p.attr("val"));if(p.hasClass("pi_tidays_dec")){n._setDecDay(q)}if(p.hasClass("pi_tidays_one")){n._setOneDay(q)}if(p.hasClass("pi_tihours_dec")){n._setDecHour(q)}if(p.hasClass("pi_tihours_one")){n._setOneHour(q)}if(p.hasClass("pi_timin_dec")){n._setDecMin(q)}if(p.hasClass("pi_timin_one")){n._setOneMin(q)}n._recalcView()}).on("mousedown",function(n){n.preventDefault?n.preventDefault():n.returnValue=false}).on("click","span.pi_tipicker_btn[act]",function(p){p.preventDefault?p.preventDefault():p.returnValue=false;p.stopPropagation();var n=p.delegateTarget;var o="action"+a.trim(a(this).attr("act"));if(typeof(n[o])==="function"){n[o]()}}).on("click",function(n){n.preventDefault?n.preventDefault():n.returnValue=false;n.stopPropagation()});m.appendTo("body");return m};var b=function(){var j=a("#pi_timepicker_popup");if(!j.length){j=c()}else{j.appendTo("body")}return j};var e=function(k){var j=b();j=j.get(0);j.setValue(k.val());j.link(k);j.rps()};var h=function(){if(a(this).data("pi_tinterval")){return}var j=a(this);if(g.hidedays){this.hidedays=1}var k=document.createElement("span");a(k).addClass("pi_timeInterval").addClass("span12").html(d(j.val()));j.css({display:"none"});k.pi_titarget=j;k.pi_tiUpdate=function(){a(this).html(d(this.pi_titarget.val()))};j.on("change",function(l){j.data("pi_tinterval").pi_tiUpdate()});a(k).on("click",function(l){l.stopPropagation();l.preventDefault?l.preventDefault():l.returnValue=false;e(this.pi_titarget)});a(k).insertAfter(j);if(j.attr("id")){a("body").on("click","label[for="+j.attr("id")+"]",function(){k.runPicker(j)})}j.data("pi_tinterval",k)};return this.each(h)}})(jQuery);